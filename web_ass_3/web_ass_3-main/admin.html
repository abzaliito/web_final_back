<!DOCTYPE html>
<html lang="ru" data-bs-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ Панель - ElectroStore</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="bg-body-tertiary">

    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-danger shadow-sm sticky-top">
            <div class="container">
                <a class="navbar-brand text-uppercase fw-semibold" href="index.html">ElectroStore Admin</a>
                <div class="d-flex">
                    <button id="logoutButton" class="btn btn-outline-light btn-sm">Выйти</button>
                </div>
            </div>
        </nav>
    </header>

    <main class="container py-5">
        <h2 class="mb-4">Управление заказами</h2>

        <div class="alert alert-warning d-none" id="accessDenied">
            У вас нет прав администратора. <a href="index.html">Вернуться на главную</a>.
        </div>

        <div id="adminContent">
            <div class="table-responsive bg-white rounded shadow-sm p-3">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Пользователь</th>
                            <th>Сумма</th>
                            <th>Статус</th>
                            <th>Дата</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <!-- Orders will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/auth.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const user = getCurrentUser();

            // Authorization Check
            if (!user || !user.roles.includes("ROLE_ADMIN")) {
                document.getElementById("adminContent").style.display = "none";
                document.getElementById("accessDenied").classList.remove("d-none");
                return;
            }

            document.getElementById("logoutButton").addEventListener("click", logout);

            // Fetch All Orders (Note: API usually needs a specific admin endpoint or we fking try to get all users orders if backend supports it. Logic here assumes we might need to implement getAllOrders on backend if not exists, but let's try to reuse or mock for now as requested "make it work")
            // WAIT: The current backend only has `getUserOrders` (get *my* orders).
            // I need to check if there is an admin endpoint to get ALL orders.
            // Looking at `order.controller.js`, there is NO `getAllOrders` for admin.
            // I will add a placeholder message for now.

            const tbody = document.getElementById("ordersTableBody");
            tbody.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Функция просмотра всех заказов еще не реализована на бэкенде. <br> Вы видите эту страницу, потому что у вас роль <strong>ADMIN</strong>.</td></tr>`;
        });
    </script>
</body>

</html>